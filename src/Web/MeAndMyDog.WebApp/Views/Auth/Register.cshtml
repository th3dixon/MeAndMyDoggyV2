@{
    ViewData["Title"] = "Register - MeAndMyDoggy";
    ViewData["Description"] = "Join MeAndMyDoggy to connect with trusted pet service providers or offer your own services to pet owners in your area.";
}

@section Styles {
    <link href="~/css/pages/auth-register.css" rel="stylesheet" />
}

<body class="bg-white font-sans" x-data="registerForm()">
    <!-- Main Content -->
    <div class="min-h-screen pt-16 relative">
        <!-- Full Background -->
        <div class="absolute inset-0 bg-gradient-to-br from-pet-orange/5 to-pet-blue/5 overflow-hidden">
            <div class="absolute inset-0 hero-pattern"></div>
            <div class="paw-print top-20 left-10 opacity-20"></div>
            <div class="paw-print top-32 right-20 opacity-20 animation-delay-1s"></div>
            <div class="paw-print bottom-20 left-32 opacity-20 animation-delay-2s"></div>
            <div class="paw-print top-96 right-40 opacity-20 animation-delay-3s"></div>
            <div class="paw-print bottom-32 right-16 opacity-20 animation-delay-4s"></div>
        </div>

        <!-- Hero Section -->
        <div class="relative py-12">
            <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="text-center">
                    <h1 class="text-3xl md:text-4xl font-display font-bold text-gray-900 mb-4">
                        Join MeAndMyDoggy
                    </h1>
                    <p class="text-lg text-gray-600 max-w-2xl mx-auto">
                        Connect with trusted pet service providers or offer your own services to pet owners in your area
                    </p>
                </div>
            </div>
        </div>

        <!-- Registration Form -->
        <div class="relative max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
            <div class="grid lg:grid-cols-2 gap-12 items-start">
                <!-- Hero Image Column (Now on the left) -->
                <div class="relative hidden lg:block order-1 lg:order-1">
                    <div class="relative z-10 transform lg:-translate-x-8">
                        <img src="~/images/register-image.jpeg" width="550" 
                             height="400"
                             alt="Happy pets registration" 
                             class="rounded-2xl shadow-2xl animate-float">
                    </div>
                    <div class="absolute -top-4 -left-4 w-72 h-72 bg-pet-blue/10 rounded-full blur-3xl"></div>
                    <div class="absolute -bottom-4 -right-4 w-60 h-60 bg-pet-orange/10 rounded-full blur-3xl"></div>
                </div>
                
                <!-- Form Column (Now on the right) -->
                <div class="relative max-w-2xl mx-auto lg:mx-0 order-2 lg:order-2">
            <!-- Progress Stepper -->
            <div class="mb-8">
                <!-- Always show all 5 steps, but hide Services step for pet owners -->
                <div class="flex items-center justify-between mb-4 max-w-lg mx-auto">
                    <!-- Step 1: Account Type -->
                    <div class="flex flex-col items-center">
                        <div class="stepper-dot" :class="currentStep >= 1 ? (currentStep === 1 ? 'active' : 'completed') : 'pending'"></div>
                    </div>
                    
                    <!-- Line 1-2 -->
                    <div class="stepper-line flex-1 mx-2" :class="currentStep > 1 ? 'completed' : ''"></div>
                    
                    <!-- Step 2: Personal Info -->
                    <div class="flex flex-col items-center">
                        <div class="stepper-dot" :class="currentStep >= 2 ? (currentStep === 2 ? 'active' : 'completed') : 'pending'"></div>
                    </div>
                    
                    <!-- Line 2-3 -->
                    <div class="stepper-line flex-1 mx-2" :class="currentStep > 2 ? 'completed' : ''"></div>
                    
                    <!-- Step 3: Address -->
                    <div class="flex flex-col items-center">
                        <div class="stepper-dot" :class="currentStep >= 3 ? (currentStep === 3 ? 'active' : 'completed') : 'pending'"></div>
                    </div>
                    
                    <!-- Line 3-4 (Services) - Hidden for pet owners -->
                    <div class="stepper-line flex-1 mx-2" 
                         :class="[
                             currentStep > 3 ? 'completed' : '',
                             formData.userType === '1' ? 'opacity-0' : ''
                         ]"
                         x-show="formData.userType === '2' || formData.userType === '3' || !formData.userType"></div>
                    
                    <!-- Step 4: Services (Hidden for pet owners) -->
                    <div class="flex flex-col items-center" 
                         x-show="formData.userType === '2' || formData.userType === '3' || !formData.userType">
                        <div class="stepper-dot" :class="currentStep >= 4 ? (currentStep === 4 ? 'active' : 'completed') : 'pending'"></div>
                    </div>
                    
                    <!-- Line 4-5 -->
                    <div class="stepper-line flex-1 mx-2" 
                         :class="[
                             (currentStep > 4 || (currentStep > 3 && formData.userType === '1')) ? 'completed' : ''
                         ]"></div>
                    
                    <!-- Step 5: Complete -->
                    <div class="flex flex-col items-center">
                        <div class="stepper-dot" :class="
                            (currentStep === 5 || (currentStep === 4 && formData.userType === '1')) ? 'active' : 
                            (currentStep > 5 || (currentStep > 4 && formData.userType === '1')) ? 'completed' : 
                            'pending'
                        "></div>
                    </div>
                </div>
                
                <!-- Step Labels -->
                <div class="flex items-center justify-between max-w-lg mx-auto text-xs text-gray-600 text-center">
                    <div class="flex-1">
                        <span>Account<br>Type</span>
                    </div>
                    <div class="flex-1">
                        <span>Personal<br>Info</span>
                    </div>
                    <div class="flex-1">
                        <span>Address</span>
                    </div>
                    <div class="flex-1" x-show="formData.userType === '2' || formData.userType === '3' || !formData.userType">
                        <span>Services</span>
                    </div>
                    <div class="flex-1">
                        <span>Complete</span>
                    </div>
                </div>
            </div>

            <!-- Form Container -->
            <div class="bg-white rounded-2xl shadow-xl border border-gray-100 p-8">
                <form @@submit.prevent="submitForm" novalidate>
                    <!-- Step 1: Account Type -->
                    <div x-show="currentStep === 1" class="form-step">
                        <h2 class="text-2xl font-display font-bold text-gray-900 mb-6">Choose Your Account Type</h2>
                        
                        <div class="space-y-4">
                            <div class="grid md:grid-cols-2 gap-4">
                                <div class="relative">
                                    <input type="radio" id="pet-owner" name="userType" value="1" x-model="formData.userType" class="sr-only">
                                    <label for="pet-owner" class="flex flex-col items-center p-6 border-2 border-gray-200 rounded-xl cursor-pointer hover:border-pet-orange transition-colors" :class="formData.userType === '1' ? 'border-pet-orange bg-pet-orange/5' : ''">
                                        <div class="w-16 h-16 bg-pet-orange/10 rounded-full flex items-center justify-center mb-4">
                                            <i class="fas fa-heart text-pet-orange text-2xl"></i>
                                        </div>
                                        <h3 class="text-lg font-semibold text-gray-900 mb-2">Pet Owner</h3>
                                        <p class="text-sm text-gray-600 text-center">Find trusted pet services for your furry friends</p>
                                    </label>
                                </div>
                                
                                <div class="relative">
                                    <input type="radio" id="service-provider" name="userType" value="2" x-model="formData.userType" class="sr-only">
                                    <label for="service-provider" class="flex flex-col items-center p-6 border-2 border-gray-200 rounded-xl cursor-pointer hover:border-pet-blue transition-colors" :class="formData.userType === '2' ? 'border-pet-blue bg-pet-blue/5' : ''">
                                        <div class="w-16 h-16 bg-pet-blue/10 rounded-full flex items-center justify-center mb-4">
                                            <i class="fas fa-briefcase text-pet-blue text-2xl"></i>
                                        </div>
                                        <h3 class="text-lg font-semibold text-gray-900 mb-2">Service Provider</h3>
                                        <p class="text-sm text-gray-600 text-center">Offer your pet care services to local pet owners</p>
                                    </label>
                                </div>
                            </div>
                            
                            <div class="relative">
                                <input type="radio" id="both" name="userType" value="3" x-model="formData.userType" class="sr-only">
                                <label for="both" class="flex items-center p-4 border-2 border-gray-200 rounded-xl cursor-pointer hover:border-pet-purple transition-colors" :class="formData.userType === '3' ? 'border-pet-purple bg-pet-purple/5' : ''">
                                    <div class="w-12 h-12 bg-pet-purple/10 rounded-full flex items-center justify-center mr-4">
                                        <i class="fas fa-users text-pet-purple text-xl"></i>
                                    </div>
                                    <div>
                                        <h3 class="text-lg font-semibold text-gray-900">Both</h3>
                                        <p class="text-sm text-gray-600">I want to find services and offer services</p>
                                    </div>
                                </label>
                            </div>
                        </div>
                        
                        <div class="mt-8 flex justify-end">
                            <button type="button" @@click="nextStep" :disabled="!formData.userType" class="bg-pet-orange text-white px-8 py-3 rounded-xl font-medium disabled:opacity-50 disabled:cursor-not-allowed hover:bg-orange-600 transition-colors">
                                Continue
                            </button>
                        </div>
                    </div>

                    <!-- Step 2: Personal Information -->
                    <div x-show="currentStep === 2" class="form-step">
                        <h2 class="text-2xl font-display font-bold text-gray-900 mb-6">Personal Information</h2>
                        
                        <div class="space-y-6">
                            <div class="grid md:grid-cols-2 gap-4">
                                <div>
                                    <label for="firstName" class="block text-sm font-medium text-gray-700 mb-2">First Name *</label>
                                    <input type="text" id="firstName" name="firstName" x-model="formData.firstName" @@input="validateField('firstName')" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-pet-orange focus:border-transparent" :class="errors.firstName ? 'input-error' : (formData.firstName && !errors.firstName ? 'input-success' : '')">
                                    <p x-show="errors.firstName" class="text-red-500 text-sm mt-1" x-text="errors.firstName"></p>
                                </div>
                                
                                <div>
                                    <label for="lastName" class="block text-sm font-medium text-gray-700 mb-2">Last Name *</label>
                                    <input type="text" id="lastName" name="lastName" x-model="formData.lastName" @@input="validateField('lastName')" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-pet-orange focus:border-transparent" :class="errors.lastName ? 'input-error' : (formData.lastName && !errors.lastName ? 'input-success' : '')">
                                    <p x-show="errors.lastName" class="text-red-500 text-sm mt-1" x-text="errors.lastName"></p>
                                </div>
                            </div>
                            
                            <div>
                                <label for="email" class="block text-sm font-medium text-gray-700 mb-2">Email Address *</label>
                                <input type="email" id="email" name="email" x-model="formData.email" @@input="validateField('email')" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-pet-orange focus:border-transparent" :class="errors.email ? 'input-error' : (formData.email && !errors.email ? 'input-success' : '')">
                                <p x-show="errors.email" class="text-red-500 text-sm mt-1" x-text="errors.email"></p>
                            </div>
                            
                            <div>
                                <label for="phoneNumber" class="block text-sm font-medium text-gray-700 mb-2">Phone Number</label>
                                <input type="tel" id="phoneNumber" name="phoneNumber" x-model="formData.phoneNumber" @@input="validateField('phoneNumber')" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-pet-orange focus:border-transparent" :class="errors.phoneNumber ? 'input-error' : (formData.phoneNumber && !errors.phoneNumber ? 'input-success' : '')">
                                <p x-show="errors.phoneNumber" class="text-red-500 text-sm mt-1" x-text="errors.phoneNumber"></p>
                            </div>
                            
                            <div>
                                <label for="password" class="block text-sm font-medium text-gray-700 mb-2">Password *</label>
                                <div class="relative">
                                    <input :type="showPassword ? 'text' : 'password'" id="password" name="password" x-model="formData.password" @@input="validateField('password')" class="w-full px-4 py-3 pr-12 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-pet-orange focus:border-transparent" :class="errors.password ? 'input-error' : (formData.password && !errors.password ? 'input-success' : '')">
                                    <button type="button" @@click="showPassword = !showPassword" class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600">
                                        <i :class="showPassword ? 'fas fa-eye-slash' : 'fas fa-eye'"></i>
                                    </button>
                                </div>
                                <div x-show="formData.password" class="mt-2">
                                    <div class="password-strength-bar w-full" :class="passwordStrength.class"></div>
                                    <p class="text-sm mt-1" :class="passwordStrength.textClass" x-text="passwordStrength.text"></p>
                                </div>
                                <p x-show="errors.password" class="text-red-500 text-sm mt-1" x-text="errors.password"></p>
                                
                                <!-- Password Requirements -->
                                <div class="mt-2 text-sm space-y-1">
                                    <div class="flex items-center space-x-2">
                                        <i class="fas fa-check text-green-500" x-show="passwordChecks.minLength"></i>
                                        <i class="fas fa-times text-red-500" x-show="!passwordChecks.minLength"></i>
                                        <span :class="passwordChecks.minLength ? 'text-green-600' : 'text-gray-500'">At least 8 characters</span>
                                    </div>
                                    <div class="flex items-center space-x-2">
                                        <i class="fas fa-check text-green-500" x-show="passwordChecks.hasUppercase"></i>
                                        <i class="fas fa-times text-red-500" x-show="!passwordChecks.hasUppercase"></i>
                                        <span :class="passwordChecks.hasUppercase ? 'text-green-600' : 'text-gray-500'">Contains uppercase letter</span>
                                    </div>
                                    <div class="flex items-center space-x-2">
                                        <i class="fas fa-check text-green-500" x-show="passwordChecks.hasLowercase"></i>
                                        <i class="fas fa-times text-red-500" x-show="!passwordChecks.hasLowercase"></i>
                                        <span :class="passwordChecks.hasLowercase ? 'text-green-600' : 'text-gray-500'">Contains lowercase letter</span>
                                    </div>
                                    <div class="flex items-center space-x-2">
                                        <i class="fas fa-check text-green-500" x-show="passwordChecks.hasDigit"></i>
                                        <i class="fas fa-times text-red-500" x-show="!passwordChecks.hasDigit"></i>
                                        <span :class="passwordChecks.hasDigit ? 'text-green-600' : 'text-gray-500'">Contains number</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div>
                                <label for="confirmPassword" class="block text-sm font-medium text-gray-700 mb-2">Confirm Password *</label>
                                <div class="relative">
                                    <input :type="showConfirmPassword ? 'text' : 'password'" id="confirmPassword" name="confirmPassword" x-model="formData.confirmPassword" @@input="validateField('confirmPassword')" class="w-full px-4 py-3 pr-12 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-pet-orange focus:border-transparent" :class="errors.confirmPassword ? 'input-error' : (formData.confirmPassword && !errors.confirmPassword ? 'input-success' : '')">
                                    <button type="button" @@click="showConfirmPassword = !showConfirmPassword" class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600">
                                        <i :class="showConfirmPassword ? 'fas fa-eye-slash' : 'fas fa-eye'"></i>
                                    </button>
                                </div>
                                <p x-show="errors.confirmPassword" class="text-red-500 text-sm mt-1" x-text="errors.confirmPassword"></p>
                            </div>
                        </div>
                        
                        <div class="mt-8 flex justify-between">
                            <button type="button" @@click="prevStep" class="bg-gray-200 text-gray-700 px-8 py-3 rounded-xl font-medium hover:bg-gray-300 transition-colors">
                                Back
                            </button>
                            <button type="button" @@click="nextStep" :disabled="!isStep2Valid" class="bg-pet-orange text-white px-8 py-3 rounded-xl font-medium disabled:opacity-50 disabled:cursor-not-allowed hover:bg-orange-600 transition-colors">
                                Continue
                            </button>
                        </div>
                    </div>

                    <!-- Step 3: Address Information -->
                    <div x-show="currentStep === 3" class="form-step">
                        <h2 class="text-2xl font-display font-bold text-gray-900 mb-6">
                            <span x-show="formData.userType === '1'">Location Information</span>
                            <span x-show="formData.userType === '2' || formData.userType === '3'">Business Address</span>
                        </h2>
                        
                        <div class="space-y-6">
                            <!-- Pet Owner - Only Postcode -->
                            <div x-show="formData.userType === '1'">
                                <div class="bg-pet-orange/5 border border-pet-orange/20 rounded-xl p-4 mb-6">
                                    <div class="flex items-center space-x-2 mb-2">
                                        <i class="fas fa-info-circle text-pet-orange"></i>
                                        <h4 class="font-medium text-gray-900">Why we need your postcode</h4>
                                    </div>
                                    <p class="text-sm text-gray-600">
                                        We use your postcode to show you pet service providers in your local area. Your exact address is never shared with providers.
                                    </p>
                                </div>
                                
                                <div>
                                    <label for="postCodePetOwner" class="block text-sm font-medium text-gray-700 mb-2">Post Code *</label>
                                    <div class="relative">
                                        <input 
                                            type="text" 
                                            id="postCodePetOwner" 
                                            name="postCode"
                                            x-model="formData.postCode" 
                                            @@input="validateField('postCode')" 
                                            placeholder="e.g. SW1A 2AA"
                                            class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-pet-orange focus:border-transparent uppercase" 
                                            :class="errors.postCode ? 'input-error' : (formData.postCode && !errors.postCode ? 'input-success' : '')"
                                        >
                                        <div x-show="formData.postCode && !errors.postCode" class="absolute right-3 top-1/2 transform -translate-y-1/2 text-green-500">
                                            <i class="fas fa-check-circle"></i>
                                        </div>
                                    </div>
                                    <p x-show="errors.postCode" class="text-red-500 text-sm mt-1" x-text="errors.postCode"></p>
                                </div>
                            </div>
                            
                            <!-- Service Provider - Full Address Lookup -->
                            <div x-show="formData.userType === '2' || formData.userType === '3'">
                                <div class="bg-pet-blue/5 border border-pet-blue/20 rounded-xl p-4 mb-6">
                                    <div class="flex items-center space-x-2 mb-2">
                                        <i class="fas fa-info-circle text-pet-blue"></i>
                                        <h4 class="font-medium text-gray-900">Business Address Required</h4>
                                    </div>
                                    <p class="text-sm text-gray-600">
                                        Your business address will be shown to pet owners when they view your profile. Make sure it's accurate and up-to-date.
                                    </p>
                                </div>
                                
                                <!-- Address Lookup -->
                                <div x-data="addressLookup()" class="relative">
                                    <label for="addressSearch" class="block text-sm font-medium text-gray-700 mb-2">
                                        Start typing your business address or postcode
                                    </label>
                                    <div class="relative">
                                        <input 
                                            type="text" 
                                            id="addressSearch"
                                            name="addressSearch"
                                            x-model="searchTerm"
                                            @@input.debounce.300ms="search"
                                            @@focus="showResults = true"
                                            @@blur.debounce.200ms="showResults = false"
                                            placeholder="e.g. 10 High Street or SW1A 2AA"
                                            class="w-full px-4 py-3 pr-10 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-pet-blue focus:border-transparent"
                                            :class="searching ? 'pr-10' : ''"
                                        >
                                        <div x-show="searching" class="absolute right-3 top-1/2 transform -translate-y-1/2">
                                            <i class="fas fa-spinner fa-spin text-pet-blue"></i>
                                        </div>
                                        <div x-show="selectedAddress" class="absolute right-3 top-1/2 transform -translate-y-1/2 text-green-500">
                                            <i class="fas fa-check-circle"></i>
                                        </div>
                                    </div>
                                    
                                    <!-- Search Results Dropdown -->
                                    <div x-show="showResults && results.length > 0" 
                                         x-transition:enter="transition ease-out duration-200"
                                         x-transition:enter-start="opacity-0 transform scale-95"
                                         x-transition:enter-end="opacity-100 transform scale-100"
                                         x-transition:leave="transition ease-in duration-100"
                                         x-transition:leave-start="opacity-100 transform scale-100"
                                         x-transition:leave-end="opacity-0 transform scale-95"
                                         class="absolute z-10 mt-2 w-full bg-white rounded-xl shadow-xl border border-gray-200 max-h-60 overflow-y-auto">
                                        <ul class="py-2">
                                            <template x-for="address in results" :key="address.cacheId || address.addressId">
                                                <li>
                                                    <button 
                                                        type="button"
                                                        @@mousedown.prevent="selectAddress(address)"
                                                        class="w-full text-left px-4 py-3 hover:bg-pet-blue/10 focus:bg-pet-blue/10 focus:outline-none transition-colors"
                                                    >
                                                        <div class="font-medium text-gray-900" x-text="address.displayText"></div>
                                                        <div class="text-sm text-gray-500" x-text="address.postcodeFormatted + ', ' + address.city"></div>
                                                    </button>
                                                </li>
                                            </template>
                                        </ul>
                                    </div>
                                    
                                    <!-- No Results Message -->
                                    <div x-show="showResults && searchTerm.length >= 3 && results.length === 0 && !searching" 
                                         class="absolute z-10 mt-2 w-full bg-white rounded-xl shadow-xl border border-gray-200 p-4 text-center text-gray-500">
                                        No addresses found. Try a different search.
                                    </div>
                                    
                                    <!-- Selected Address Preview -->
                                    <div x-show="selectedAddress" x-transition class="mt-3 p-4 bg-green-50 border border-green-200 rounded-xl">
                                        <div class="flex items-start justify-between">
                                            <div>
                                                <p class="text-sm font-medium text-green-800 mb-1">Selected Business Address:</p>
                                                <p class="text-sm text-green-700" x-text="selectedAddress?.displayText"></p>
                                            </div>
                                            <button type="button" @@click="clearSelection" class="text-green-600 hover:text-green-800">
                                                <i class="fas fa-times"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Manual Entry Option -->
                                <div x-data="{ manualEntry: false }">
                                    <button type="button" @@click="manualEntry = !manualEntry" class="text-sm text-pet-blue hover:text-blue-700 flex items-center space-x-1 mt-4">
                                        <i class="fas" :class="manualEntry ? 'fa-chevron-up' : 'fa-chevron-down'"></i>
                                        <span x-text="manualEntry ? 'Hide manual entry' : 'Enter address manually'"></span>
                                    </button>
                                    
                                    <div x-show="manualEntry" x-transition class="mt-4 space-y-4 p-4 bg-gray-50 rounded-xl">
                                        <div>
                                            <label for="postCodeProvider" class="block text-sm font-medium text-gray-700 mb-2">Post Code *</label>
                                            <input type="text" id="postCodeProvider" name="postCodeProvider" x-model="formData.postCode" @@input="validateField('postCode')" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-pet-blue focus:border-transparent uppercase" :class="errors.postCode ? 'input-error' : (formData.postCode && !errors.postCode ? 'input-success' : '')">
                                            <p x-show="errors.postCode" class="text-red-500 text-sm mt-1" x-text="errors.postCode"></p>
                                        </div>
                                        
                                        <div>
                                            <label for="addressLine1" class="block text-sm font-medium text-gray-700 mb-2">Address Line 1 *</label>
                                            <input type="text" id="addressLine1" name="addressLine1" x-model="formData.addressLine1" @@input="validateField('addressLine1')" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-pet-blue focus:border-transparent" :class="errors.addressLine1 ? 'input-error' : ''">
                                            <p x-show="errors.addressLine1" class="text-red-500 text-sm mt-1" x-text="errors.addressLine1"></p>
                                        </div>
                                        
                                        <div>
                                            <label for="addressLine2" class="block text-sm font-medium text-gray-700 mb-2">Address Line 2</label>
                                            <input type="text" id="addressLine2" name="addressLine2" x-model="formData.addressLine2" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-pet-blue focus:border-transparent">
                                        </div>
                                        
                                        <div>
                                            <label for="city" class="block text-sm font-medium text-gray-700 mb-2">City *</label>
                                            <input type="text" id="city" name="city" x-model="formData.city" @@input="validateField('city')" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-pet-blue focus:border-transparent" :class="errors.city ? 'input-error' : ''">
                                            <p x-show="errors.city" class="text-red-500 text-sm mt-1" x-text="errors.city"></p>
                                        </div>
                                        
                                        <div>
                                            <label for="county" class="block text-sm font-medium text-gray-700 mb-2">County</label>
                                            <input type="text" id="county" name="county" x-model="formData.county" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-pet-blue focus:border-transparent">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Service Provider Additional Fields -->
                            <div x-show="formData.userType === '1' || formData.userType === '2'" class="space-y-6 border-t border-gray-200 pt-6">
                                <h3 class="text-lg font-semibold text-gray-900">Business Information</h3>
                                
                                <div>
                                    <label for="businessName" class="block text-sm font-medium text-gray-700 mb-2">Business Name *</label>
                                    <input type="text" id="businessName" name="businessName" x-model="formData.businessName" @@input="validateField('businessName')" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-pet-orange focus:border-transparent" :class="errors.businessName ? 'input-error' : (formData.businessName && !errors.businessName ? 'input-success' : '')">
                                    <p x-show="errors.businessName" class="text-red-500 text-sm mt-1" x-text="errors.businessName"></p>
                                </div>
                                
                                <div>
                                    <label for="businessType" class="block text-sm font-medium text-gray-700 mb-2">Business Type *</label>
                                    <select id="businessType" name="businessType" x-model="formData.businessType" @@change="validateField('businessType')" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-pet-orange focus:border-transparent">
                                        <option value="">Select business type</option>
                                        <option value="0">Individual</option>
                                        <option value="1">Company</option>
                                    </select>
                                    <p x-show="errors.businessType" class="text-red-500 text-sm mt-1" x-text="errors.businessType"></p>
                                </div>
                                
                                <!-- Company/VAT fields removed to reduce registration friction -->
                            </div>
                        </div>
                        
                        <div class="mt-8 flex justify-between">
                            <button type="button" @@click="prevStep" class="bg-gray-200 text-gray-700 px-8 py-3 rounded-xl font-medium hover:bg-gray-300 transition-colors">
                                Back
                            </button>
                            <button type="button" @@click="nextStep" :disabled="!isStep3Valid" class="bg-pet-orange text-white px-8 py-3 rounded-xl font-medium disabled:opacity-50 disabled:cursor-not-allowed hover:bg-orange-600 transition-colors">
                                <span x-show="formData.userType === '1'">Continue to Review</span>
                                <span x-show="formData.userType === '2' || formData.userType === '3'">Continue to Services</span>
                            </button>
                        </div>
                    </div>

                    <!-- Step 4: Service & Pricing Setup (Service Providers Only) -->
                    <div x-show="currentStep === 4 && (formData.userType === '2' || formData.userType === '3')" class="form-step">
                        <h2 class="text-2xl font-display font-bold text-gray-900 mb-6">Service & Pricing Setup</h2>
                        
                        <div class="space-y-8">
                            <div class="bg-pet-orange/5 border border-pet-orange/20 rounded-xl p-4">
                                <div class="flex items-center space-x-2 mb-2">
                                    <i class="fas fa-info-circle text-pet-orange"></i>
                                    <h4 class="font-medium text-gray-900">Required Information</h4>
                                </div>
                                <p class="text-sm text-gray-600">
                                    You must select at least one service category and one sub-service within each category, along with your rates.
                                </p>
                            </div>

                            <!-- Loading State -->
                            <div x-show="loadingServices" class="flex justify-center items-center py-8">
                                <i class="fas fa-spinner fa-spin text-pet-orange text-2xl mr-2"></i>
                                <span class="text-gray-600">Loading services...</span>
                            </div>
                            
                            <!-- Service Categories -->
                            <div x-show="!loadingServices" class="space-y-6">
                                <template x-for="category in serviceCategories" :key="category.serviceCategoryId">
                                    <div class="border border-gray-200 rounded-xl p-6">
                                        <div class="flex items-center space-x-3 mb-4">
                                            <input 
                                                type="checkbox" 
                                                :id="'service-' + category.serviceCategoryId" 
                                                :name="'service-' + category.serviceCategoryId"
                                                x-model="formData.services[category.serviceCategoryId].selected" 
                                                @@change="validateServices()" 
                                                class="rounded border-gray-300 text-pet-orange focus:ring-pet-orange"
                                            >
                                            <label :for="'service-' + category.serviceCategoryId" class="flex items-center">
                                                <i :class="category.iconClass + ' text-pet-orange mr-2'"></i>
                                                <span class="font-semibold text-gray-900" x-text="category.name"></span>
                                            </label>
                                        </div>
                                        
                                        <template x-if="formData.services[category.serviceCategoryId].selected">
                                            <div class="space-y-4">
                                                <div class="grid md:grid-cols-2 gap-4">
                                                    <template x-for="subService in category.subServices" :key="subService.subServiceId">
                                                        <div>
                                                            <label class="flex items-center space-x-2">
                                                                <input 
                                                                    type="checkbox" 
                                                                    :name="'subservice-' + category.serviceCategoryId + '-' + subService.subServiceId"
                                                                    x-model="formData.services[category.serviceCategoryId].subServices[subService.subServiceId].selected" 
                                                                    @@change="validateServices()"
                                                                    class="rounded border-gray-300 text-pet-orange focus:ring-pet-orange"
                                                                >
                                                                <span class="text-sm text-gray-700" x-text="subService.name"></span>
                                                            </label>
                                                            <template x-if="formData.services[category.serviceCategoryId].subServices[subService.subServiceId].selected">
                                                                <div class="mt-2 ml-6">
                                                                    <div class="flex items-center space-x-2">
                                                                        <span class="text-sm text-gray-600">£</span>
                                                                        <input 
                                                                            type="number" 
                                                                            step="0.01" 
                                                                            min="1" 
                                                                            required
                                                                            :name="'rate-' + category.serviceCategoryId + '-' + subService.subServiceId"
                                                                            x-model="formData.services[category.serviceCategoryId].subServices[subService.subServiceId].rate" 
                                                                            @@input="validateServices()"
                                                                            class="w-20 px-2 py-1 border border-gray-300 rounded text-sm focus:ring-2 focus:ring-pet-orange focus:border-transparent"
                                                                            placeholder="0.00"
                                                                        >
                                                                        <span class="text-sm text-gray-600" x-text="subService.pricingType === 'PerHour' ? 'per hour' : 'per service'"></span>
                                                                    </div>
                                                                </div>
                                                            </template>
                                                        </div>
                                                    </template>
                                                </div>
                                            </div>
                                        </template>
                                    </div>
                                </template>
                            </div>
                            
                            <div x-show="errors.services" class="text-red-500 text-sm" x-text="errors.services"></div>
                        </div>
                        
                        <div class="mt-8 flex justify-between">
                            <button type="button" @@click="prevStep" class="bg-gray-200 text-gray-700 px-8 py-3 rounded-xl font-medium hover:bg-gray-300 transition-colors">
                                Back
                            </button>
                            <button type="button" @@click="nextStep" :disabled="!isStep4Valid" class="bg-pet-orange text-white px-8 py-3 rounded-xl font-medium disabled:opacity-50 disabled:cursor-not-allowed hover:bg-orange-600 transition-colors">
                                Continue to Review
                            </button>
                        </div>
                    </div>

                    <!-- Step 5: Review and Submit -->
                    <div x-show="currentStep === 5 || (currentStep === 4 && formData.userType === '1')" class="form-step">
                        <h2 class="text-2xl font-display font-bold text-gray-900 mb-6">Review Your Information</h2>
                        
                        <div class="space-y-6">
                            <div class="bg-gray-50 rounded-xl p-6">
                                <h3 class="text-lg font-semibold text-gray-900 mb-4">Account Type</h3>
                                <p class="text-gray-600" x-text="getUserTypeText()"></p>
                            </div>
                            
                            <div class="bg-gray-50 rounded-xl p-6">
                                <h3 class="text-lg font-semibold text-gray-900 mb-4">Personal Information</h3>
                                <div class="grid md:grid-cols-2 gap-4 text-sm">
                                    <div>
                                        <span class="font-medium text-gray-700">Name:</span>
                                        <span class="text-gray-600" x-text="formData.firstName + ' ' + formData.lastName"></span>
                                    </div>
                                    <div>
                                        <span class="font-medium text-gray-700">Email:</span>
                                        <span class="text-gray-600" x-text="formData.email"></span>
                                    </div>
                                    <div x-show="formData.phoneNumber">
                                        <span class="font-medium text-gray-700">Phone:</span>
                                        <span class="text-gray-600" x-text="formData.phoneNumber"></span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="bg-pet-orange/5 border border-pet-orange/20 rounded-xl p-4">
                                <div class="flex items-center space-x-2 mb-2">
                                    <i class="fas fa-info-circle text-pet-orange"></i>
                                    <h4 class="font-medium text-gray-900">What happens next?</h4>
                                </div>
                                <p class="text-sm text-gray-600">
                                    After registering, you'll receive a verification email. You'll need to verify your email address before you can start using your account.
                                </p>
                            </div>
                            
                            <div class="flex items-center space-x-2">
                                <input type="checkbox" id="agreeTerms" name="agreeTerms" x-model="formData.agreeTerms" class="rounded border-gray-300 text-pet-orange focus:ring-pet-orange">
                                <label for="agreeTerms" class="text-sm text-gray-700">
                                    I agree to the <a href="#" class="text-pet-orange hover:underline">Terms of Service</a> and <a href="#" class="text-pet-orange hover:underline">Privacy Policy</a>
                                </label>
                            </div>
                        </div>
                        
                        <div class="mt-8 flex justify-between">
                            <button type="button" @@click="prevStep" class="bg-gray-200 text-gray-700 px-8 py-3 rounded-xl font-medium hover:bg-gray-300 transition-colors">
                                Back
                            </button>
                            <button type="button" @@click="submitForm()" :disabled="!formData.agreeTerms || isSubmitting" class="bg-pet-orange text-white px-8 py-3 rounded-xl font-medium disabled:opacity-50 disabled:cursor-not-allowed hover:bg-orange-600 transition-colors">
                                <span x-show="!isSubmitting">Create Account</span>
                                <span x-show="isSubmitting">
                                    <i class="fas fa-spinner fa-spin mr-2"></i>Creating Account...
                                </span>
                            </button>
                        </div>
                    </div>
                </form>
            </div>
                </div>
            </div>
        </div>
    </div>
</body>

@section Scripts {
    <script src="/js/common/modal.js"></script>
    <script src="/js/pages/register.js"></script>
    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
}